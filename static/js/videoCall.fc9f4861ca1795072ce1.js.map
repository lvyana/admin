{"version":3,"file":"static/js/videoCall.fc9f4861ca1795072ce1.js","mappings":"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","sources":["views/plugin/videoCall/index.tsx","utils/html2canvas.ts"],"sourcesContent":["/**\r\n * @file 视频通话\r\n * @author ly\r\n * @createDate 2023年6月14日\r\n */\r\nimport React, { useRef, useState } from 'react';\r\nimport { Button } from 'antd';\r\nimport downloadImg from '@/utils/html2canvas';\r\n\r\n// #----------- 上: ts类型定义 ----------- 分割线 ----------- 下: JS代码 -----------\r\n\r\nconst VideoCall = () => {\r\n\tconst [recording, setRecording] = useState(false);\r\n\tconst [cameraOn, setCameraOn] = useState(false);\r\n\tconst videoRef = useRef<HTMLVideoElement | null>(null);\r\n\tconst mediaRecorderRef = useRef<MediaRecorder | null>(null);\r\n\tconst chunksRef = useRef<BlobPart[]>([]);\r\n\r\n\tconst handleStartRecording = async () => {\r\n\t\tif (!cameraOn) {\r\n\t\t\tawait turnCameraOn();\r\n\t\t}\r\n\r\n\t\tif (videoRef.current && videoRef.current.srcObject) {\r\n\t\t\tmediaRecorderRef.current = new MediaRecorder(videoRef.current.srcObject as MediaStream, { mimeType: 'video/webm' });\r\n\t\t}\r\n\r\n\t\tif (mediaRecorderRef.current) {\r\n\t\t\tmediaRecorderRef.current.ondataavailable = handleDataAvailable;\r\n\t\t\tmediaRecorderRef.current.start();\r\n\t\t\tsetRecording(true);\r\n\t\t}\r\n\t};\r\n\r\n\tconst turnCameraOn = async () => {\r\n\t\ttry {\r\n\t\t\tconst stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });\r\n\t\t\tif (videoRef.current) {\r\n\t\t\t\tvideoRef.current.srcObject = stream;\r\n\t\t\t}\r\n\t\t\tsetCameraOn(true);\r\n\t\t} catch (error) {\r\n\t\t\t// console.error(error);\r\n\t\t}\r\n\t};\r\n\r\n\tconst handleDataAvailable = (event: BlobEvent) => {\r\n\t\tchunksRef.current.push(event.data);\r\n\t};\r\n\r\n\tconst handleStopRecording = () => {\r\n\t\tmediaRecorderRef.current?.stop();\r\n\t\tsetRecording(false);\r\n\t};\r\n\r\n\tconst turnCameraOff = () => {\r\n\t\tconst stream = videoRef.current?.srcObject;\r\n\t\tif (stream) {\r\n\t\t\tif ('getTracks' in stream) {\r\n\t\t\t\tconst tracks = stream.getTracks();\r\n\t\t\t\ttracks.forEach((track) => {\r\n\t\t\t\t\ttrack.stop();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (videoRef.current) {\r\n\t\t\tvideoRef.current.srcObject = null;\r\n\t\t}\r\n\r\n\t\tsetCameraOn(false);\r\n\t};\r\n\r\n\tconst downloadVideo = () => {\r\n\t\tconst blob = new Blob(chunksRef.current, { type: 'video/webm' });\r\n\t\tconst url = URL.createObjectURL(blob);\r\n\t\tconst a = document.createElement('a');\r\n\t\ta.href = url;\r\n\t\ta.download = 'video.webm';\r\n\t\tdocument.body.appendChild(a);\r\n\t\ta.click();\r\n\t\tdocument.body.removeChild(a);\r\n\t\tURL.revokeObjectURL(url);\r\n\t\tchunksRef.current = [];\r\n\t};\r\n\r\n\tconst saveImg = () => {\r\n\t\tconst cameraVideo = document.getElementById('cameraVideo');\r\n\t\tif (cameraVideo) {\r\n\t\t\tdownloadImg(cameraVideo);\r\n\t\t}\r\n\t};\r\n\r\n\treturn (\r\n\t\t<div>\r\n\t\t\t<video id=\"cameraVideo\" ref={videoRef} autoPlay />\r\n\t\t\t<div>\r\n\t\t\t\t{!cameraOn && (\r\n\t\t\t\t\t<Button type=\"primary\" onClick={turnCameraOn}>\r\n\t\t\t\t\t\t打开摄像头\r\n\t\t\t\t\t</Button>\r\n\t\t\t\t)}\r\n\t\t\t\t{cameraOn && !recording && (\r\n\t\t\t\t\t<Button type=\"primary\" onClick={handleStartRecording}>\r\n\t\t\t\t\t\t开始录制\r\n\t\t\t\t\t</Button>\r\n\t\t\t\t)}\r\n\t\t\t\t{recording && (\r\n\t\t\t\t\t<Button type=\"primary\" onClick={handleStopRecording}>\r\n\t\t\t\t\t\t停止录制\r\n\t\t\t\t\t</Button>\r\n\t\t\t\t)}\r\n\t\t\t\t{cameraOn && !recording && (\r\n\t\t\t\t\t<Button type=\"primary\" onClick={turnCameraOff}>\r\n\t\t\t\t\t\t关闭摄像头\r\n\t\t\t\t\t</Button>\r\n\t\t\t\t)}\r\n\t\t\t\t{mediaRecorderRef.current && mediaRecorderRef.current.state === 'inactive' && (\r\n\t\t\t\t\t<Button type=\"primary\" onClick={downloadVideo}>\r\n\t\t\t\t\t\t下载视频\r\n\t\t\t\t\t</Button>\r\n\t\t\t\t)}\r\n\t\t\t\t{cameraOn && (\r\n\t\t\t\t\t<Button type=\"primary\" onClick={saveImg}>\r\n\t\t\t\t\t\t拍照\r\n\t\t\t\t\t</Button>\r\n\t\t\t\t)}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n};\r\n\r\nexport default VideoCall;\r\n","/**\r\n * @file html2canvas下载图片\r\n * @author ly\r\n * @createDate 2023年1月10日\r\n */\r\nimport html2canvas from 'html2canvas';\r\n\r\nconst downloadImg = (dom: HTMLElement) => {\r\n\thtml2canvas(dom).then((canvas) => {\r\n\t\tlet url = canvas.toDataURL('image/png');\r\n\t\tlet aLink = document.createElement('a');\r\n\t\taLink.style.display = 'none';\r\n\t\taLink.href = url;\r\n\t\t// console.log(aLink.href);\r\n\t\taLink.download = '截图.png';\r\n\t\tdocument.body.appendChild(aLink);\r\n\t\taLink.click();\r\n\t\tdocument.body.removeChild(aLink);\r\n\t});\r\n};\r\n\r\nexport default downloadImg;\r\n"],"names":["_useState","useState","_useState2","_slicedToArray","recording","setRecording","_useState3","_useState4","cameraOn","setCameraOn","videoRef","useRef","mediaRecorderRef","chunksRef","handleStartRecording","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","wrap","_context","prev","next","turnCameraOn","current","srcObject","MediaRecorder","mimeType","ondataavailable","handleDataAvailable","start","stop","apply","arguments","_ref2","_callee2","stream","_context2","navigator","mediaDevices","getUserMedia","video","audio","sent","t0","event","push","data","_jsxs","children","_jsx","id","ref","autoPlay","Button","type","onClick","_mediaRecorderRef$cur","_videoRef$current","getTracks","forEach","track","state","blob","Blob","url","URL","createObjectURL","a","document","createElement","href","download","body","appendChild","click","removeChild","revokeObjectURL","dom","cameraVideo","getElementById","html2canvas","then","canvas","toDataURL","aLink","style","display"],"sourceRoot":""}
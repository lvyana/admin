{"version":3,"file":"static/js/richTextEdit.7a0f08d48d9470f71fe1.js","mappings":"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","sources":["../node_modules/@wangeditor/editor-for-react/src/components/Editor.tsx","../node_modules/@wangeditor/editor-for-react/src/components/Toolbar.tsx","views/plugin/richTextEdit/components/Preview.tsx","views/plugin/richTextEdit/index.tsx"],"sourcesContent":["/**\n * @description editor react component\n * @author wangfupeng\n */\n\nimport React, { useRef, useEffect, useState } from 'react'\nimport {SlateDescendant, IEditorConfig, createEditor, IDomEditor, SlateEditor, SlateTransforms } from '@wangeditor/editor'\n\ninterface IProps {\n  defaultContent?: SlateDescendant[]\n  onCreated?: (editor: IDomEditor) => void\n  defaultHtml?: string\n  value?: string\n  onChange: (editor: IDomEditor) => void\n  defaultConfig: Partial<IEditorConfig>\n  mode?: string\n  style?: React.CSSProperties\n  className?: string\n}\n\nfunction EditorComponent(props: Partial<IProps>) {\n  const { defaultContent = [], onCreated, defaultHtml = '', value = '', onChange, defaultConfig = {}, mode = 'default', style = {}, className } = props\n  const ref = useRef<HTMLDivElement>(null)\n  const [editor, setEditor] = useState<IDomEditor | null>(null)\n  const [curValue, setCurValue] = useState('')\n\n  const handleCreated = (editor: IDomEditor) => {\n    // 组件属性 onCreated\n    if (onCreated) onCreated(editor)\n\n    // 编辑器 配置 onCreated\n    const { onCreated: onCreatedFromConfig } = defaultConfig\n    if (onCreatedFromConfig) onCreatedFromConfig(editor)\n  }\n\n  const handleChanged = (editor: IDomEditor) => {\n    setCurValue(editor.getHtml()) // 记录当前 html 值\n\n    // 组件属性 onChange\n    if (onChange) onChange(editor)\n\n    // 编辑器 配置 onChange\n    const { onChange: onChangeFromConfig } = defaultConfig\n    if (onChangeFromConfig) onChangeFromConfig(editor)\n  }\n\n  const handleDestroyed = (editor: IDomEditor) => {\n    const { onDestroyed } = defaultConfig\n    setEditor(null)\n    if(onDestroyed) {\n      onDestroyed(editor)\n    }\n  }\n\n  // value 变化，重置 HTML\n  useEffect(() => {\n    if (editor == null) return\n\n    if (value === curValue) return // 如果和当前 html 值相等，则忽略\n\n    // ------ 重新设置 HTML ------\n    try {\n      editor.setHtml(value)\n    } catch (error) {\n      console.error(error)\n    }\n\n  }, [value])\n\n  useEffect(() => {\n    if (ref.current == null) return\n    if (editor != null) return\n    // 防止重复渲染 当编辑器已经创建就不在创建了\n    if (ref.current?.getAttribute('data-w-e-textarea')) return\n\n    const newEditor = createEditor({\n      selector: ref.current,\n      config: {\n        ...defaultConfig,\n        onCreated: handleCreated,\n        onChange: handleChanged,\n        onDestroyed: handleDestroyed,\n      },\n      content: defaultContent,\n      html: defaultHtml || value,\n      mode,\n    })\n    setEditor(newEditor)\n  }, [editor])\n\n  return <div style={style} ref={ref} className={className}></div>\n}\n\nexport default EditorComponent\n","/**\n * @description toolbar react component\n * @author wangfupeng\n */\n\nimport React, { useRef, useEffect } from 'react'\nimport * as wangEditor from '@wangeditor/editor'\n\ninterface IProps {\n  editor: wangEditor.IDomEditor | null\n  defaultConfig?: Partial<wangEditor.IToolbarConfig>\n  mode?: string\n  style?: object\n  className?: string\n}\n\nfunction ToolbarComponent(props: IProps) {\n  const { editor, defaultConfig = {}, mode = 'default', style = {}, className } = props\n  const ref = useRef<HTMLDivElement>(null)\n\n  useEffect(() => {\n    if (ref.current == null) return\n    if (editor == null) return\n\n    wangEditor.createToolbar({\n      editor,\n      selector: ref.current,\n      config: defaultConfig,\n      mode,\n    })\n  }, [editor])\n\n  return <div style={style} ref={ref} className={className}></div>\n}\n\nexport default ToolbarComponent\n","import React, { DetailedHTMLProps, FC, HTMLAttributes, ReactNode } from 'react';\r\nimport { Row, Col } from 'antd';\r\n\r\ninterface Iprops {\r\n\tcontent: string;\r\n}\r\nconst Preview: FC<Iprops> = ({ content }) => {\r\n\treturn (\r\n\t\t<Row>\r\n\t\t\t<Col span={12}>\r\n\t\t\t\t<div dangerouslySetInnerHTML={{ __html: content }}></div>\r\n\t\t\t</Col>\r\n\t\t\t<Col span={12}>\r\n\t\t\t\t<div>{content}</div>\r\n\t\t\t</Col>\r\n\t\t</Row>\r\n\t);\r\n};\r\n\r\nexport default Preview;\r\n","/**\r\n * @file 富文本编辑器 https://www.wangeditor.com/v5/guide/API.html#%E5%86%85%E5%AE%B9%E5%A4%84%E7%90%86\r\n * @author ly\r\n * @createDate 2022年4月3日\r\n */\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport '@wangeditor/editor/dist/css/style.css';\r\nimport { Editor, Toolbar } from '@wangeditor/editor-for-react';\r\nimport {\r\n\tIDomEditor, // 编辑器实例接口\r\n\tIEditorConfig, // 编辑器配置\r\n\tIToolbarConfig // 工具栏配置\r\n} from '@wangeditor/editor';\r\nimport Imodal, { OnOkOrCancelType } from '@/antdComponents/iModal';\r\nimport Preview from './components/Preview';\r\nimport { Modal, Button, Space } from 'antd';\r\nimport { ExclamationCircleOutlined } from '@ant-design/icons';\r\nimport dayjs from 'dayjs';\r\nimport Icard from '@/antdComponents/iCard';\r\n\r\nconst { confirm } = Modal;\r\n\r\nexport interface ISingleMenuConfig {\r\n\tserver: string;\r\n}\r\nexport interface IMenuConfig {\r\n\tuploadImage?: ISingleMenuConfig;\r\n}\r\n\r\n// #----------- 上: ts类型定义 ----------- 分割线 ----------- 下: JS代码 -----------\r\n\r\nconst RichTextEdit = () => {\r\n\tconst [editor, setEditor] = useState<IDomEditor | null>(null); // 存储 editor 实例\r\n\tconst defaultHtml = `<h2>针对目前前端中台项目优化方案</h2><h3>1、代码管理&nbsp;git&nbsp;分支管理&nbsp;版本分支&nbsp;&nbsp;上线流程</h3><p><img src=\"https://project-1308388249.cos.ap-guangzhou.myqcloud.com/git.png\" alt=\"git\" data-href=\"https://project-1308388249.cos.ap-guangzhou.myqcloud.com/git.png\" style=\"width: 785.00px;height: 622.20px;\"/></p><h3>2、项目优化&nbsp;页面加载慢&nbsp;组件体验不好&nbsp;文件管理&nbsp;数据管理&nbsp;</h3><p>2.1、页面加载&nbsp;webpack打包优化，减少代码体积、静态文件放到cdn、路由懒加载、预加载</p><p>2.2、组件体验&nbsp;交互效果、组件性能调整</p><p>2.3、文件管理&nbsp;约定好文件名字、文件目录结构</p><p>2.4、针对项目使用较多的幂等数据存放vuex状态管理、较多的接口用mixin进行封装</p><h3>3、组件优化&nbsp;公共组件&nbsp;</h3><p>3.1、公共组件封装要减少使用负担</p><p>3.2、考虑公共组件封装使用场景，不必追求封装而封装</p><h3>4、代码优化</h3>`;\r\n\tconst toolbarConfig = {};\r\n\tconst editorConfig: Partial<IEditorConfig> = {\r\n\t\tplaceholder: '请输入内容...',\r\n\t\tonCreated(editor: IDomEditor) {\r\n\t\t\tsetEditor(editor);\r\n\t\t}, // 记录下 editor 实例，重要！\r\n\t\tMENU_CONF: {}\r\n\t};\r\n\r\n\t// 上传图片\r\n\t(editorConfig.MENU_CONF as IMenuConfig)['uploadImage'] = {\r\n\t\tserver: '/api/upload'\r\n\t};\r\n\r\n\t// 及时销毁 editor ，重要！\r\n\tuseEffect(() => {\r\n\t\treturn () => {\r\n\t\t\tif (editor === null) return;\r\n\t\t\teditor.destroy();\r\n\t\t\tsetEditor(null);\r\n\t\t};\r\n\t}, [editor]);\r\n\r\n\tconst [content, setContent] = useState('');\r\n\r\n\t// 弹窗\r\n\tconst [open, setOpen] = useState(false);\r\n\tconst [confirmLoading, setConfirmLoading] = useState(false);\r\n\r\n\tconst onOkOrCancel: OnOkOrCancelType = (type) => {\r\n\t\tsetOpen(false);\r\n\t};\r\n\r\n\tconst onSubmit = () => {\r\n\t\t// console.log(editor?.children); // 节点对象\r\n\t\t// console.log(editor?.getHtml()); //获取非格式化的 html\r\n\t\tlet time = dayjs().format('YYYY-MM-DD');\r\n\t\t// console.log(time);\r\n\r\n\t\tconfirm({\r\n\t\t\ttitle: 'Do you Want to delete these items?',\r\n\t\t\ticon: <ExclamationCircleOutlined />,\r\n\t\t\tcontent: 'Some descriptions',\r\n\t\t\tonOk() {},\r\n\t\t\tonCancel() {}\r\n\t\t});\r\n\t};\r\n\r\n\t// 预览\r\n\tconst onPreview = () => {\r\n\t\tsetContent(editor?.getHtml() as string);\r\n\t\tsetOpen(true);\r\n\t};\r\n\r\n\treturn (\r\n\t\t<div>\r\n\t\t\t<Icard>\r\n\t\t\t\t<Toolbar editor={editor} defaultConfig={toolbarConfig} mode=\"default\" style={{ borderBottom: '1px solid #ccc' }} />\r\n\t\t\t\t<Editor defaultConfig={editorConfig} defaultHtml={defaultHtml} mode=\"default\" style={{ height: '500px' }} />\r\n\t\t\t\t<div className=\"mt-2\">\r\n\t\t\t\t\t<Button type=\"primary\" onClick={onSubmit} style={{ marginRight: '5px' }}>\r\n\t\t\t\t\t\t提交\r\n\t\t\t\t\t</Button>\r\n\t\t\t\t\t<Button type=\"primary\" onClick={onPreview}>\r\n\t\t\t\t\t\t预览\r\n\t\t\t\t\t</Button>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<Imodal title=\"预览模板\" width=\"1000px\" open={open} confirmLoading={confirmLoading} onOkOrCancel={onOkOrCancel}>\r\n\t\t\t\t\t<Preview content={content}></Preview>\r\n\t\t\t\t</Imodal>\r\n\t\t\t</Icard>\r\n\t\t</div>\r\n\t);\r\n};\r\nexport default RichTextEdit;\r\n"],"names":["u","n","defaultContent","c","d","onCreated","f","defaultHtml","v","s","value","m","y","onChange","g","defaultConfig","h","p","mode","C","b","style","w","N","className","x","t","E","i","r","H","O","j","D","S","T","e","A","getHtml","P","onDestroyed","o","setHtml","console","error","current","getAttribute","l","selector","config","a","content","html","ref","editor","_ref","_jsxs","Row","children","_jsx","Col","span","dangerouslySetInnerHTML","__html","confirm","Modal","_useState","useState","_useState2","_slicedToArray","setEditor","editorConfig","placeholder","MENU_CONF","server","useEffect","destroy","_useState3","_useState4","setContent","_useState5","_useState6","open","setOpen","_useState7","_useState8","confirmLoading","Icard","Toolbar","borderBottom","Editor","height","Button","type","onClick","dayjs","format","title","icon","ExclamationCircleOutlined","onOk","onCancel","marginRight","Imodal","width","onOkOrCancel","Preview"],"sourceRoot":""}